<!doctype html>
<html>
<head>
<title>../third_party/icu/source/i18n/islamcal.cpp</title>
<style type="text/css">
 body { color:#000000; background-color:#ffffff }
 body { font-family:Helvetica, sans-serif; font-size:10pt }
 h1 { font-size:14pt }
 .code { border-collapse:collapse; width:100%; }
 .code { font-family: "Monospace", monospace; font-size:10pt }
 .code { line-height: 1.2em }
 .comment { color: green; font-style: oblique }
 .keyword { color: blue }
 .string_literal { color: red }
 .directive { color: darkmagenta }
 .expansion { display: none; }
 .macro:hover .expansion { display: block; border: 2px solid #FF0000; padding: 2px; background-color:#FFF0F0; font-weight: normal;   -webkit-border-radius:5px;  -webkit-box-shadow:1px 1px 7px #000;   border-radius:5px;  box-shadow:1px 1px 7px #000; position: absolute; top: -1em; left:10em; z-index: 1 } 
 .macro { color: darkmagenta; background-color:LemonChiffon; position: relative }
 .num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
 .num { text-align:right; font-size:8pt }
 .num { color:#444444 }
 .line { padding-left: 1ex; border-left: 3px solid #ccc }
 .line { white-space: pre }
 .msg { -webkit-box-shadow:1px 1px 7px #000 }
 .msg { box-shadow:1px 1px 7px #000 }
 .msg { -webkit-border-radius:5px }
 .msg { border-radius:5px }
 .msg { font-family:Helvetica, sans-serif; font-size:8pt }
 .msg { float:left }
 .msg { padding:0.25em 1ex 0.25em 1ex }
 .msg { margin-top:10px; margin-bottom:10px }
 .msg { font-weight:bold }
 .msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
 .msgT { padding:0x; spacing:0x }
 .msgEvent { background-color:#fff8b4; color:#000000 }
 .msgControl { background-color:#bbbbbb; color:#000000 }
 .mrange { background-color:#dfddf3 }
 .mrange { border-bottom:1px solid #6F9DBE }
 .PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
 .PathIndex { -webkit-border-radius:8px }
 .PathIndex { border-radius:8px }
 .PathIndexEvent { background-color:#bfba87 }
 .PathIndexControl { background-color:#8c8c8c }
 .PathNav a { text-decoration:none; font-size: larger }
 .CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
 .CodeRemovalHint { background-color:#de1010 }
 .CodeRemovalHint { border-bottom:1px solid #6F9DBE }
 table.simpletable {
   padding: 5px;
   font-size:12pt;
   margin:20px;
   border-collapse: collapse; border-spacing: 0px;
 }
 td.rowname {
   text-align:right; font-weight:bold; color:#444444;
   padding-right:2ex; }
</style>
</head>
<body>
<!-- BUGDESC Value stored to 'startDate' is never read -->

<!-- BUGTYPE Dead assignment -->

<!-- BUGCATEGORY Dead store -->

<!-- BUGFILE /home/haha/code/v8_5_0/v8/out/../third_party/icu/source/i18n/islamcal.cpp -->

<!-- FILENAME islamcal.cpp -->

<!-- FUNCTIONNAME handleComputeFields -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 5fb2f77f4cecb847956b50e9689b3669 -->

<!-- BUGLINE 584 -->

<!-- BUGCOLUMN 9 -->

<!-- BUGPATHLENGTH 1 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>out/../third_party/icu/source/i18n/islamcal.cpp</td></tr>
<tr><td class="rowname">Location:</td><td><a href="#EndPath">line 584, column 9</a></td></tr>
<tr><td class="rowname">Description:</td><td>Value stored to 'startDate' is never read</td></tr>
</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<table class="code">
<tr><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2">2</td><td class="line"><span class='comment'>******************************************************************************</span></td></tr>
<tr><td class="num" id="LN3">3</td><td class="line"><span class='comment'>* Copyright (C) 2003-2014, International Business Machines Corporation</span></td></tr>
<tr><td class="num" id="LN4">4</td><td class="line"><span class='comment'>* and others. All Rights Reserved.</span></td></tr>
<tr><td class="num" id="LN5">5</td><td class="line"><span class='comment'>******************************************************************************</span></td></tr>
<tr><td class="num" id="LN6">6</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN7">7</td><td class="line"><span class='comment'>* File ISLAMCAL.H</span></td></tr>
<tr><td class="num" id="LN8">8</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN9">9</td><td class="line"><span class='comment'>* Modification History:</span></td></tr>
<tr><td class="num" id="LN10">10</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN11">11</td><td class="line"><span class='comment'>*   Date        Name        Description</span></td></tr>
<tr><td class="num" id="LN12">12</td><td class="line"><span class='comment'>*   10/14/2003  srl         ported from java IslamicCalendar</span></td></tr>
<tr><td class="num" id="LN13">13</td><td class="line"><span class='comment'>*****************************************************************************</span></td></tr>
<tr><td class="num" id="LN14">14</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN15">15</td><td class="line"> </td></tr>
<tr><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "islamcal.h"</span></td></tr>
<tr><td class="num" id="LN17">17</td><td class="line"> </td></tr>
<tr><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#if !<span class='macro'>UCONFIG_NO_FORMATTING<span class='expansion'>0</span></span></span></td></tr>
<tr><td class="num" id="LN19">19</td><td class="line"> </td></tr>
<tr><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "umutex.h"</span></td></tr>
<tr><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include &lt;float.h&gt;</span></td></tr>
<tr><td class="num" id="LN22">22</td><td class="line"><span class='directive'>#include "gregoimp.h" // Math</span></td></tr>
<tr><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#include "astro.h" // CalendarAstronomer</span></td></tr>
<tr><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#include "uhash.h"</span></td></tr>
<tr><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#include "ucln_in.h"</span></td></tr>
<tr><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#include "uassert.h"</span></td></tr>
<tr><td class="num" id="LN27">27</td><td class="line"> </td></tr>
<tr><td class="num" id="LN28">28</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> UDate HIJRA_MILLIS = -42521587200000.0;    <span class='comment'>// 7/16/622 AD 00:00</span></td></tr>
<tr><td class="num" id="LN29">29</td><td class="line"> </td></tr>
<tr><td class="num" id="LN30">30</td><td class="line"><span class='comment'>// Debugging</span></td></tr>
<tr><td class="num" id="LN31">31</td><td class="line"><span class='directive'>#ifdef U_DEBUG_ISLAMCAL</span></td></tr>
<tr><td class="num" id="LN32">32</td><td class="line"><span class='directive'># include &lt;stdio.h&gt;</span></td></tr>
<tr><td class="num" id="LN33">33</td><td class="line"><span class='directive'># include &lt;stdarg.h&gt;</span></td></tr>
<tr><td class="num" id="LN34">34</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> debug_islamcal_loc(<span class='keyword'>const</span> <span class='keyword'>char</span> *f, int32_t l)</td></tr>
<tr><td class="num" id="LN35">35</td><td class="line">{</td></tr>
<tr><td class="num" id="LN36">36</td><td class="line">    fprintf(<span class='macro'>stderr<span class='expansion'>stderr</span></span>, <span class='string_literal'>"%s:%d: "</span>, f, l);</td></tr>
<tr><td class="num" id="LN37">37</td><td class="line">}</td></tr>
<tr><td class="num" id="LN38">38</td><td class="line"> </td></tr>
<tr><td class="num" id="LN39">39</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> debug_islamcal_msg(<span class='keyword'>const</span> <span class='keyword'>char</span> *pat, ...)</td></tr>
<tr><td class="num" id="LN40">40</td><td class="line">{</td></tr>
<tr><td class="num" id="LN41">41</td><td class="line">    va_list ap;</td></tr>
<tr><td class="num" id="LN42">42</td><td class="line">    <span class='macro'>va_start(ap, pat)<span class='expansion'>__builtin_va_start(ap, pat)</span></span>;</td></tr>
<tr><td class="num" id="LN43">43</td><td class="line">    vfprintf(<span class='macro'>stderr<span class='expansion'>stderr</span></span>, pat, ap);</td></tr>
<tr><td class="num" id="LN44">44</td><td class="line">    fflush(<span class='macro'>stderr<span class='expansion'>stderr</span></span>);</td></tr>
<tr><td class="num" id="LN45">45</td><td class="line">}</td></tr>
<tr><td class="num" id="LN46">46</td><td class="line"><span class='comment'>// must use double parens, i.e.:  U_DEBUG_ISLAMCAL_MSG(("four is: %d",4));</span></td></tr>
<tr><td class="num" id="LN47">47</td><td class="line"><span class='directive'>#define U_DEBUG_ISLAMCAL_MSG(x) {debug_islamcal_loc(<span class='macro'>__FILE__<span class='expansion'>"../third_party/icu/source/i18n/islamcal.cpp"</span></span>,<span class='macro'>__LINE__<span class='expansion'>47</span></span>);debug_islamcal_msg x;}</span></td></tr>
<tr><td class="num" id="LN48">48</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr><td class="num" id="LN49">49</td><td class="line"><span class='directive'>#define U_DEBUG_ISLAMCAL_MSG(x)</span></td></tr>
<tr><td class="num" id="LN50">50</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr><td class="num" id="LN51">51</td><td class="line"> </td></tr>
<tr><td class="num" id="LN52">52</td><td class="line"> </td></tr>
<tr><td class="num" id="LN53">53</td><td class="line"><span class='comment'>// --- The cache --</span></td></tr>
<tr><td class="num" id="LN54">54</td><td class="line"><span class='comment'>// cache of months</span></td></tr>
<tr><td class="num" id="LN55">55</td><td class="line"><span class='keyword'>static</span> UMutex astroLock = <span class='macro'>U_MUTEX_INITIALIZER<span class='expansion'>{{ { 0, 0, 0, 0, 0, 0, 0, { 0, 0 } } }}</span></span>;  <span class='comment'>// pod bay door lock</span></td></tr>
<tr><td class="num" id="LN56">56</td><td class="line"><span class='keyword'>static</span> icu::CalendarCache *gMonthCache = <span class='macro'>NULL<span class='expansion'>__null</span></span>;</td></tr>
<tr><td class="num" id="LN57">57</td><td class="line"><span class='keyword'>static</span> icu::CalendarAstronomer *gIslamicCalendarAstro = <span class='macro'>NULL<span class='expansion'>__null</span></span>;</td></tr>
<tr><td class="num" id="LN58">58</td><td class="line"> </td></tr>
<tr><td class="num" id="LN59">59</td><td class="line"><span class='macro'>U_CDECL_BEGIN<span class='expansion'>extern "C" {</span></span></td></tr>
<tr><td class="num" id="LN60">60</td><td class="line"><span class='keyword'>static</span> UBool calendar_islamic_cleanup(<span class='keyword'>void</span>) {</td></tr>
<tr><td class="num" id="LN61">61</td><td class="line">    <span class='keyword'>if</span> (gMonthCache) {</td></tr>
<tr><td class="num" id="LN62">62</td><td class="line">        <span class='keyword'>delete</span> gMonthCache;</td></tr>
<tr><td class="num" id="LN63">63</td><td class="line">        gMonthCache = <span class='macro'>NULL<span class='expansion'>__null</span></span>;</td></tr>
<tr><td class="num" id="LN64">64</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN65">65</td><td class="line">    <span class='keyword'>if</span> (gIslamicCalendarAstro) {</td></tr>
<tr><td class="num" id="LN66">66</td><td class="line">        <span class='keyword'>delete</span> gIslamicCalendarAstro;</td></tr>
<tr><td class="num" id="LN67">67</td><td class="line">        gIslamicCalendarAstro = <span class='macro'>NULL<span class='expansion'>__null</span></span>;</td></tr>
<tr><td class="num" id="LN68">68</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN69">69</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>TRUE<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN70">70</td><td class="line">}</td></tr>
<tr><td class="num" id="LN71">71</td><td class="line"><span class='macro'>U_CDECL_END<span class='expansion'>}</span></span></td></tr>
<tr><td class="num" id="LN72">72</td><td class="line"> </td></tr>
<tr><td class="num" id="LN73">73</td><td class="line"><span class='macro'>U_NAMESPACE_BEGIN<span class='expansion'>extern "C++" { namespace icu_54 {</span></span></td></tr>
<tr><td class="num" id="LN74">74</td><td class="line"> </td></tr>
<tr><td class="num" id="LN75">75</td><td class="line"><span class='comment'>// Implementation of the IslamicCalendar class</span></td></tr>
<tr><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr><td class="num" id="LN77">77</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN78">78</td><td class="line"> <span class='comment'>* Friday EPOC</span></td></tr>
<tr><td class="num" id="LN79">79</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN80">80</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> int32_t CIVIL_EPOC = 1948440; <span class='comment'>// CE 622 July 16 Friday (Julian calendar) / CE 622 July 19 (Gregorian calendar)</span></td></tr>
<tr><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr><td class="num" id="LN82">82</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN83">83</td><td class="line">  <span class='comment'>* Thursday EPOC</span></td></tr>
<tr><td class="num" id="LN84">84</td><td class="line">  <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN85">85</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> int32_t ASTRONOMICAL_EPOC = 1948439; <span class='comment'>// CE 622 July 15 Thursday (Julian calendar)</span></td></tr>
<tr><td class="num" id="LN86">86</td><td class="line"> </td></tr>
<tr><td class="num" id="LN87">87</td><td class="line"> </td></tr>
<tr><td class="num" id="LN88">88</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> int32_t UMALQURA_YEAR_START = 1300;</td></tr>
<tr><td class="num" id="LN89">89</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> int32_t UMALQURA_YEAR_END = 1600;</td></tr>
<tr><td class="num" id="LN90">90</td><td class="line"> </td></tr>
<tr><td class="num" id="LN91">91</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> UMALQURA_MONTHLENGTH[] = {</td></tr>
<tr><td class="num" id="LN92">92</td><td class="line">    <span class='comment'>//* 1300 -1302 */ "1010 1010 1010", "1101 0101 0100", "1110 1100 1001",</span></td></tr>
<tr><td class="num" id="LN93">93</td><td class="line">                            0x0AAA,           0x0D54,           0x0EC9,</td></tr>
<tr><td class="num" id="LN94">94</td><td class="line">    <span class='comment'>//* 1303 -1307 */ "0110 1101 0100", "0110 1110 1010", "0011 0110 1100", "1010 1010 1101", "0101 0101 0101",</span></td></tr>
<tr><td class="num" id="LN95">95</td><td class="line">                            0x06D4,           0x06EA,           0x036C,           0x0AAD,           0x0555,</td></tr>
<tr><td class="num" id="LN96">96</td><td class="line">    <span class='comment'>//* 1308 -1312 */ "0110 1010 1001", "0111 1001 0010", "1011 1010 1001", "0101 1101 0100", "1010 1101 1010",</span></td></tr>
<tr><td class="num" id="LN97">97</td><td class="line">                            0x06A9,           0x0792,           0x0BA9,           0x05D4,           0x0ADA,</td></tr>
<tr><td class="num" id="LN98">98</td><td class="line">    <span class='comment'>//* 1313 -1317 */ "0101 0101 1100", "1101 0010 1101", "0110 1001 0101", "0111 0100 1010", "1011 0101 0100",</span></td></tr>
<tr><td class="num" id="LN99">99</td><td class="line">                            0x055C,           0x0D2D,           0x0695,           0x074A,           0x0B54,</td></tr>
<tr><td class="num" id="LN100">100</td><td class="line">    <span class='comment'>//* 1318 -1322 */ "1011 0110 1010", "0101 1010 1101", "0100 1010 1110", "1010 0100 1111", "0101 0001 0111",</span></td></tr>
<tr><td class="num" id="LN101">101</td><td class="line">                            0x0B6A,           0x05AD,           0x04AE,           0x0A4F,           0x0517,</td></tr>
<tr><td class="num" id="LN102">102</td><td class="line">    <span class='comment'>//* 1323 -1327 */ "0110 1000 1011", "0110 1010 0101", "1010 1101 0101", "0010 1101 0110", "1001 0101 1011",</span></td></tr>
<tr><td class="num" id="LN103">103</td><td class="line">                            0x068B,           0x06A5,           0x0AD5,           0x02D6,           0x095B,</td></tr>
<tr><td class="num" id="LN104">104</td><td class="line">    <span class='comment'>//* 1328 -1332 */ "0100 1001 1101", "1010 0100 1101", "1101 0010 0110", "1101 1001 0101", "0101 1010 1100",</span></td></tr>
<tr><td class="num" id="LN105">105</td><td class="line">                            0x049D,           0x0A4D,           0x0D26,           0x0D95,           0x05AC,</td></tr>
<tr><td class="num" id="LN106">106</td><td class="line">    <span class='comment'>//* 1333 -1337 */ "1001 1011 0110", "0010 1011 1010", "1010 0101 1011", "0101 0010 1011", "1010 1001 0101",</span></td></tr>
<tr><td class="num" id="LN107">107</td><td class="line">                            0x09B6,           0x02BA,           0x0A5B,           0x052B,           0x0A95,</td></tr>
<tr><td class="num" id="LN108">108</td><td class="line">    <span class='comment'>//* 1338 -1342 */ "0110 1100 1010", "1010 1110 1001", "0010 1111 0100", "1001 0111 0110", "0010 1011 0110",</span></td></tr>
<tr><td class="num" id="LN109">109</td><td class="line">                            0x06CA,           0x0AE9,           0x02F4,           0x0976,           0x02B6,</td></tr>
<tr><td class="num" id="LN110">110</td><td class="line">    <span class='comment'>//* 1343 -1347 */ "1001 0101 0110", "1010 1100 1010", "1011 1010 0100", "1011 1101 0010", "0101 1101 1001",</span></td></tr>
<tr><td class="num" id="LN111">111</td><td class="line">                            0x0956,           0x0ACA,           0x0BA4,           0x0BD2,           0x05D9,</td></tr>
<tr><td class="num" id="LN112">112</td><td class="line">    <span class='comment'>//* 1348 -1352 */ "0010 1101 1100", "1001 0110 1101", "0101 0100 1101", "1010 1010 0101", "1011 0101 0010",</span></td></tr>
<tr><td class="num" id="LN113">113</td><td class="line">                            0x02DC,           0x096D,           0x054D,           0x0AA5,           0x0B52,</td></tr>
<tr><td class="num" id="LN114">114</td><td class="line">    <span class='comment'>//* 1353 -1357 */ "1011 1010 0101", "0101 1011 0100", "1001 1011 0110", "0101 0101 0111", "0010 1001 0111",</span></td></tr>
<tr><td class="num" id="LN115">115</td><td class="line">                            0x0BA5,           0x05B4,           0x09B6,           0x0557,           0x0297,</td></tr>
<tr><td class="num" id="LN116">116</td><td class="line">    <span class='comment'>//* 1358 -1362 */ "0101 0100 1011", "0110 1010 0011", "0111 0101 0010", "1011 0110 0101", "0101 0110 1010",</span></td></tr>
<tr><td class="num" id="LN117">117</td><td class="line">                            0x054B,           0x06A3,           0x0752,           0x0B65,           0x056A,</td></tr>
<tr><td class="num" id="LN118">118</td><td class="line">    <span class='comment'>//* 1363 -1367 */ "1010 1010 1011", "0101 0010 1011", "1100 1001 0101", "1101 0100 1010", "1101 1010 0101",</span></td></tr>
<tr><td class="num" id="LN119">119</td><td class="line">                            0x0AAB,           0x052B,           0x0C95,           0x0D4A,           0x0DA5,</td></tr>
<tr><td class="num" id="LN120">120</td><td class="line">    <span class='comment'>//* 1368 -1372 */ "0101 1100 1010", "1010 1101 0110", "1001 0101 0111", "0100 1010 1011", "1001 0100 1011",</span></td></tr>
<tr><td class="num" id="LN121">121</td><td class="line">                            0x05CA,           0x0AD6,           0x0957,           0x04AB,           0x094B,</td></tr>
<tr><td class="num" id="LN122">122</td><td class="line">    <span class='comment'>//* 1373 -1377 */ "1010 1010 0101", "1011 0101 0010", "1011 0110 1010", "0101 0111 0101", "0010 0111 0110",</span></td></tr>
<tr><td class="num" id="LN123">123</td><td class="line">                            0x0AA5,           0x0B52,           0x0B6A,           0x0575,           0x0276,</td></tr>
<tr><td class="num" id="LN124">124</td><td class="line">    <span class='comment'>//* 1378 -1382 */ "1000 1011 0111", "0100 0101 1011", "0101 0101 0101", "0101 1010 1001", "0101 1011 0100",</span></td></tr>
<tr><td class="num" id="LN125">125</td><td class="line">                            0x08B7,           0x045B,           0x0555,           0x05A9,           0x05B4,</td></tr>
<tr><td class="num" id="LN126">126</td><td class="line">    <span class='comment'>//* 1383 -1387 */ "1001 1101 1010", "0100 1101 1101", "0010 0110 1110", "1001 0011 0110", "1010 1010 1010",</span></td></tr>
<tr><td class="num" id="LN127">127</td><td class="line">                            0x09DA,           0x04DD,           0x026E,           0x0936,           0x0AAA,</td></tr>
<tr><td class="num" id="LN128">128</td><td class="line">    <span class='comment'>//* 1388 -1392 */ "1101 0101 0100", "1101 1011 0010", "0101 1101 0101", "0010 1101 1010", "1001 0101 1011",</span></td></tr>
<tr><td class="num" id="LN129">129</td><td class="line">                            0x0D54,           0x0DB2,           0x05D5,           0x02DA,           0x095B,</td></tr>
<tr><td class="num" id="LN130">130</td><td class="line">    <span class='comment'>//* 1393 -1397 */ "0100 1010 1011", "1010 0101 0101", "1011 0100 1001", "1011 0110 0100", "1011 0111 0001",</span></td></tr>
<tr><td class="num" id="LN131">131</td><td class="line">                            0x04AB,           0x0A55,           0x0B49,           0x0B64,           0x0B71,</td></tr>
<tr><td class="num" id="LN132">132</td><td class="line">    <span class='comment'>//* 1398 -1402 */ "0101 1011 0100", "1010 1011 0101", "1010 0101 0101", "1101 0010 0101", "1110 1001 0010",</span></td></tr>
<tr><td class="num" id="LN133">133</td><td class="line">                            0x05B4,           0x0AB5,           0x0A55,           0x0D25,           0x0E92,</td></tr>
<tr><td class="num" id="LN134">134</td><td class="line">    <span class='comment'>//* 1403 -1407 */ "1110 1100 1001", "0110 1101 0100", "1010 1110 1001", "1001 0110 1011", "0100 1010 1011",</span></td></tr>
<tr><td class="num" id="LN135">135</td><td class="line">                            0x0EC9,           0x06D4,           0x0AE9,           0x096B,           0x04AB,</td></tr>
<tr><td class="num" id="LN136">136</td><td class="line">    <span class='comment'>//* 1408 -1412 */ "1010 1001 0011", "1101 0100 1001", "1101 1010 0100", "1101 1011 0010", "1010 1011 1001",</span></td></tr>
<tr><td class="num" id="LN137">137</td><td class="line">                            0x0A93,           0x0D49,         0x0DA4,           0x0DB2,           0x0AB9,</td></tr>
<tr><td class="num" id="LN138">138</td><td class="line">    <span class='comment'>//* 1413 -1417 */ "0100 1011 1010", "1010 0101 1011", "0101 0010 1011", "1010 1001 0101", "1011 0010 1010",</span></td></tr>
<tr><td class="num" id="LN139">139</td><td class="line">                            0x04BA,           0x0A5B,           0x052B,           0x0A95,           0x0B2A,</td></tr>
<tr><td class="num" id="LN140">140</td><td class="line">    <span class='comment'>//* 1418 -1422 */ "1011 0101 0101", "0101 0101 1100", "0100 1011 1101", "0010 0011 1101", "1001 0001 1101",</span></td></tr>
<tr><td class="num" id="LN141">141</td><td class="line">                            0x0B55,           0x055C,           0x04BD,           0x023D,           0x091D,</td></tr>
<tr><td class="num" id="LN142">142</td><td class="line">    <span class='comment'>//* 1423 -1427 */ "1010 1001 0101", "1011 0100 1010", "1011 0101 1010", "0101 0110 1101", "0010 1011 0110",</span></td></tr>
<tr><td class="num" id="LN143">143</td><td class="line">                            0x0A95,           0x0B4A,           0x0B5A,           0x056D,           0x02B6,</td></tr>
<tr><td class="num" id="LN144">144</td><td class="line">    <span class='comment'>//* 1428 -1432 */ "1001 0011 1011", "0100 1001 1011", "0110 0101 0101", "0110 1010 1001", "0111 0101 0100",</span></td></tr>
<tr><td class="num" id="LN145">145</td><td class="line">                            0x093B,           0x049B,           0x0655,           0x06A9,           0x0754,</td></tr>
<tr><td class="num" id="LN146">146</td><td class="line">    <span class='comment'>//* 1433 -1437 */ "1011 0110 1010", "0101 0110 1100", "1010 1010 1101", "0101 0101 0101", "1011 0010 1001",</span></td></tr>
<tr><td class="num" id="LN147">147</td><td class="line">                            0x0B6A,           0x056C,           0x0AAD,           0x0555,           0x0B29,</td></tr>
<tr><td class="num" id="LN148">148</td><td class="line">    <span class='comment'>//* 1438 -1442 */ "1011 1001 0010", "1011 1010 1001", "0101 1101 0100", "1010 1101 1010", "0101 0101 1010",</span></td></tr>
<tr><td class="num" id="LN149">149</td><td class="line">                            0x0B92,           0x0BA9,           0x05D4,           0x0ADA,           0x055A,</td></tr>
<tr><td class="num" id="LN150">150</td><td class="line">    <span class='comment'>//* 1443 -1447 */ "1010 1010 1011", "0101 1001 0101", "0111 0100 1001", "0111 0110 0100", "1011 1010 1010",</span></td></tr>
<tr><td class="num" id="LN151">151</td><td class="line">                            0x0AAB,           0x0595,           0x0749,           0x0764,           0x0BAA,</td></tr>
<tr><td class="num" id="LN152">152</td><td class="line">    <span class='comment'>//* 1448 -1452 */ "0101 1011 0101", "0010 1011 0110", "1010 0101 0110", "1110 0100 1101", "1011 0010 0101",</span></td></tr>
<tr><td class="num" id="LN153">153</td><td class="line">                            0x05B5,           0x02B6,           0x0A56,           0x0E4D,           0x0B25,</td></tr>
<tr><td class="num" id="LN154">154</td><td class="line">    <span class='comment'>//* 1453 -1457 */ "1011 0101 0010", "1011 0110 1010", "0101 1010 1101", "0010 1010 1110", "1001 0010 1111",</span></td></tr>
<tr><td class="num" id="LN155">155</td><td class="line">                            0x0B52,           0x0B6A,           0x05AD,           0x02AE,           0x092F,</td></tr>
<tr><td class="num" id="LN156">156</td><td class="line">    <span class='comment'>//* 1458 -1462 */ "0100 1001 0111", "0110 0100 1011", "0110 1010 0101", "0110 1010 1100", "1010 1101 0110",</span></td></tr>
<tr><td class="num" id="LN157">157</td><td class="line">                            0x0497,           0x064B,           0x06A5,           0x06AC,           0x0AD6,</td></tr>
<tr><td class="num" id="LN158">158</td><td class="line">    <span class='comment'>//* 1463 -1467 */ "0101 0101 1101", "0100 1001 1101", "1010 0100 1101", "1101 0001 0110", "1101 1001 0101",</span></td></tr>
<tr><td class="num" id="LN159">159</td><td class="line">                            0x055D,           0x049D,           0x0A4D,           0x0D16,           0x0D95,</td></tr>
<tr><td class="num" id="LN160">160</td><td class="line">    <span class='comment'>//* 1468 -1472 */ "0101 1010 1010", "0101 1011 0101", "0010 1101 1010", "1001 0101 1011", "0100 1010 1101",</span></td></tr>
<tr><td class="num" id="LN161">161</td><td class="line">                            0x05AA,           0x05B5,           0x02DA,           0x095B,           0x04AD,</td></tr>
<tr><td class="num" id="LN162">162</td><td class="line">    <span class='comment'>//* 1473 -1477 */ "0101 1001 0101", "0110 1100 1010", "0110 1110 0100", "1010 1110 1010", "0100 1111 0101",</span></td></tr>
<tr><td class="num" id="LN163">163</td><td class="line">                            0x0595,           0x06CA,           0x06E4,           0x0AEA,           0x04F5,</td></tr>
<tr><td class="num" id="LN164">164</td><td class="line">    <span class='comment'>//* 1478 -1482 */ "0010 1011 0110", "1001 0101 0110", "1010 1010 1010", "1011 0101 0100", "1011 1101 0010",</span></td></tr>
<tr><td class="num" id="LN165">165</td><td class="line">                            0x02B6,           0x0956,           0x0AAA,           0x0B54,           0x0BD2,</td></tr>
<tr><td class="num" id="LN166">166</td><td class="line">    <span class='comment'>//* 1483 -1487 */ "0101 1101 1001", "0010 1110 1010", "1001 0110 1101", "0100 1010 1101", "1010 1001 0101",</span></td></tr>
<tr><td class="num" id="LN167">167</td><td class="line">                            0x05D9,           0x02EA,           0x096D,           0x04AD,           0x0A95,</td></tr>
<tr><td class="num" id="LN168">168</td><td class="line">    <span class='comment'>//* 1488 -1492 */ "1011 0100 1010", "1011 1010 0101", "0101 1011 0010", "1001 1011 0101", "0100 1101 0110",</span></td></tr>
<tr><td class="num" id="LN169">169</td><td class="line">                            0x0B4A,           0x0BA5,           0x05B2,           0x09B5,           0x04D6,</td></tr>
<tr><td class="num" id="LN170">170</td><td class="line">    <span class='comment'>//* 1493 -1497 */ "1010 1001 0111", "0101 0100 0111", "0110 1001 0011", "0111 0100 1001", "1011 0101 0101",</span></td></tr>
<tr><td class="num" id="LN171">171</td><td class="line">                            0x0A97,           0x0547,           0x0693,           0x0749,           0x0B55,</td></tr>
<tr><td class="num" id="LN172">172</td><td class="line">    <span class='comment'>//* 1498 -1508 */ "0101 0110 1010", "1010 0110 1011", "0101 0010 1011", "1010 1000 1011", "1101 0100 0110", "1101 1010 0011", "0101 1100 1010", "1010 1101 0110", "0100 1101 1011", "0010 0110 1011", "1001 0100 1011",</span></td></tr>
<tr><td class="num" id="LN173">173</td><td class="line">                            0x056A,           0x0A6B,           0x052B,           0x0A8B,           0x0D46,           0x0DA3,           0x05CA,           0x0AD6,           0x04DB,           0x026B,           0x094B,</td></tr>
<tr><td class="num" id="LN174">174</td><td class="line">    <span class='comment'>//* 1509 -1519 */ "1010 1010 0101", "1011 0101 0010", "1011 0110 1001", "0101 0111 0101", "0001 0111 0110", "1000 1011 0111", "0010 0101 1011", "0101 0010 1011", "0101 0110 0101", "0101 1011 0100", "1001 1101 1010",</span></td></tr>
<tr><td class="num" id="LN175">175</td><td class="line">                            0x0AA5,           0x0B52,           0x0B69,           0x0575,           0x0176,           0x08B7,           0x025B,           0x052B,           0x0565,           0x05B4,           0x09DA,</td></tr>
<tr><td class="num" id="LN176">176</td><td class="line">    <span class='comment'>//* 1520 -1530 */ "0100 1110 1101", "0001 0110 1101", "1000 1011 0110", "1010 1010 0110", "1101 0101 0010", "1101 1010 1001", "0101 1101 0100", "1010 1101 1010", "1001 0101 1011", "0100 1010 1011", "0110 0101 0011",</span></td></tr>
<tr><td class="num" id="LN177">177</td><td class="line">                            0x04ED,           0x016D,           0x08B6,           0x0AA6,           0x0D52,           0x0DA9,           0x05D4,           0x0ADA,           0x095B,           0x04AB,           0x0653,</td></tr>
<tr><td class="num" id="LN178">178</td><td class="line">    <span class='comment'>//* 1531 -1541 */ "0111 0010 1001", "0111 0110 0010", "1011 1010 1001", "0101 1011 0010", "1010 1011 0101", "0101 0101 0101", "1011 0010 0101", "1101 1001 0010", "1110 1100 1001", "0110 1101 0010", "1010 1110 1001",</span></td></tr>
<tr><td class="num" id="LN179">179</td><td class="line">                            0x0729,           0x0762,           0x0BA9,           0x05B2,           0x0AB5,           0x0555,           0x0B25,           0x0D92,           0x0EC9,           0x06D2,           0x0AE9,</td></tr>
<tr><td class="num" id="LN180">180</td><td class="line">    <span class='comment'>//* 1542 -1552 */ "0101 0110 1011", "0100 1010 1011", "1010 0101 0101", "1101 0010 1001", "1101 0101 0100", "1101 1010 1010", "1001 1011 0101", "0100 1011 1010", "1010 0011 1011", "0100 1001 1011", "1010 0100 1101",</span></td></tr>
<tr><td class="num" id="LN181">181</td><td class="line">                            0x056B,           0x04AB,           0x0A55,           0x0D29,           0x0D54,           0x0DAA,           0x09B5,           0x04BA,           0x0A3B,           0x049B,           0x0A4D,</td></tr>
<tr><td class="num" id="LN182">182</td><td class="line">    <span class='comment'>//* 1553 -1563 */ "1010 1010 1010", "1010 1101 0101", "0010 1101 1010", "1001 0101 1101", "0100 0101 1110", "1010 0010 1110", "1100 1001 1010", "1101 0101 0101", "0110 1011 0010", "0110 1011 1001", "0100 1011 1010",</span></td></tr>
<tr><td class="num" id="LN183">183</td><td class="line">                            0x0AAA,           0x0AD5,           0x02DA,           0x095D,           0x045E,           0x0A2E,           0x0C9A,           0x0D55,           0x06B2,           0x06B9,           0x04BA,</td></tr>
<tr><td class="num" id="LN184">184</td><td class="line">    <span class='comment'>//* 1564 -1574 */ "1010 0101 1101", "0101 0010 1101", "1010 1001 0101", "1011 0101 0010", "1011 1010 1000", "1011 1011 0100", "0101 1011 1001", "0010 1101 1010", "1001 0101 1010", "1011 0100 1010", "1101 1010 0100",</span></td></tr>
<tr><td class="num" id="LN185">185</td><td class="line">                            0x0A5D,           0x052D,           0x0A95,           0x0B52,           0x0BA8,           0x0BB4,           0x05B9,           0x02DA,           0x095A,           0x0B4A,           0x0DA4,</td></tr>
<tr><td class="num" id="LN186">186</td><td class="line">    <span class='comment'>//* 1575 -1585 */ "1110 1101 0001", "0110 1110 1000", "1011 0110 1010", "0101 0110 1101", "0101 0011 0101", "0110 1001 0101", "1101 0100 1010", "1101 1010 1000", "1101 1101 0100", "0110 1101 1010", "0101 0101 1011",</span></td></tr>
<tr><td class="num" id="LN187">187</td><td class="line">                            0x0ED1,           0x06E8,           0x0B6A,           0x056D,           0x0535,           0x0695,           0x0D4A,           0x0DA8,           0x0DD4,           0x06DA,           0x055B,</td></tr>
<tr><td class="num" id="LN188">188</td><td class="line">    <span class='comment'>//* 1586 -1596 */ "0010 1001 1101", "0110 0010 1011", "1011 0001 0101", "1011 0100 1010", "1011 1001 0101", "0101 1010 1010", "1010 1010 1110", "1001 0010 1110", "1100 1000 1111", "0101 0010 0111", "0110 1001 0101",</span></td></tr>
<tr><td class="num" id="LN189">189</td><td class="line">                            0x029D,           0x062B,           0x0B15,           0x0B4A,           0x0B95,           0x05AA,           0x0AAE,           0x092E,           0x0C8F,           0x0527,           0x0695,</td></tr>
<tr><td class="num" id="LN190">190</td><td class="line">    <span class='comment'>//* 1597 -1600 */ "0110 1010 1010", "1010 1101 0110", "0101 0101 1101", "0010 1001 1101", };</span></td></tr>
<tr><td class="num" id="LN191">191</td><td class="line">                            0x06AA,           0x0AD6,           0x055D,           0x029D</td></tr>
<tr><td class="num" id="LN192">192</td><td class="line">};</td></tr>
<tr><td class="num" id="LN193">193</td><td class="line"> </td></tr>
<tr><td class="num" id="LN194">194</td><td class="line">int32_t getUmalqura_MonthLength(int32_t y, int32_t m) {</td></tr>
<tr><td class="num" id="LN195">195</td><td class="line">    int32_t mask = (int32_t) (0x01 &lt;&lt; (11 - m));    <span class='comment'>// set mask for bit corresponding to month</span></td></tr>
<tr><td class="num" id="LN196">196</td><td class="line">    <span class='keyword'>if</span>((UMALQURA_MONTHLENGTH[y] &amp; mask) == 0 )</td></tr>
<tr><td class="num" id="LN197">197</td><td class="line">        <span class='keyword'>return</span> 29;</td></tr>
<tr><td class="num" id="LN198">198</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN199">199</td><td class="line">        <span class='keyword'>return</span> 30;</td></tr>
<tr><td class="num" id="LN200">200</td><td class="line"> </td></tr>
<tr><td class="num" id="LN201">201</td><td class="line">}</td></tr>
<tr><td class="num" id="LN202">202</td><td class="line"> </td></tr>
<tr><td class="num" id="LN203">203</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN204">204</td><td class="line"><span class='comment'>// Constructors...</span></td></tr>
<tr><td class="num" id="LN205">205</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN206">206</td><td class="line"> </td></tr>
<tr><td class="num" id="LN207">207</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *IslamicCalendar::getType() <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN208">208</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *sType = <span class='macro'>NULL<span class='expansion'>__null</span></span>;</td></tr>
<tr><td class="num" id="LN209">209</td><td class="line"> </td></tr>
<tr><td class="num" id="LN210">210</td><td class="line">    <span class='keyword'>switch</span> (cType) {</td></tr>
<tr><td class="num" id="LN211">211</td><td class="line">    <span class='keyword'>case</span> CIVIL:</td></tr>
<tr><td class="num" id="LN212">212</td><td class="line">        sType = <span class='string_literal'>"islamic-civil"</span>;</td></tr>
<tr><td class="num" id="LN213">213</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN214">214</td><td class="line">    <span class='keyword'>case</span> ASTRONOMICAL:</td></tr>
<tr><td class="num" id="LN215">215</td><td class="line">        sType = <span class='string_literal'>"islamic"</span>;</td></tr>
<tr><td class="num" id="LN216">216</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN217">217</td><td class="line">    <span class='keyword'>case</span> TBLA:</td></tr>
<tr><td class="num" id="LN218">218</td><td class="line">        sType = <span class='string_literal'>"islamic-tbla"</span>;</td></tr>
<tr><td class="num" id="LN219">219</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN220">220</td><td class="line">    <span class='keyword'>case</span> UMALQURA:</td></tr>
<tr><td class="num" id="LN221">221</td><td class="line">        sType = <span class='string_literal'>"islamic-umalqura"</span>;</td></tr>
<tr><td class="num" id="LN222">222</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN223">223</td><td class="line">    <span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN224">224</td><td class="line">        U_ASSERT(<span class='keyword'>false</span>); <span class='comment'>// out of range</span></td></tr>
<tr><td class="num" id="LN225">225</td><td class="line">        sType = <span class='string_literal'>"islamic"</span>;  <span class='comment'>// "islamic" is used as the generic type</span></td></tr>
<tr><td class="num" id="LN226">226</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN227">227</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN228">228</td><td class="line">    <span class='keyword'>return</span> sType;</td></tr>
<tr><td class="num" id="LN229">229</td><td class="line">}</td></tr>
<tr><td class="num" id="LN230">230</td><td class="line"> </td></tr>
<tr><td class="num" id="LN231">231</td><td class="line">Calendar* IslamicCalendar::clone() <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN232">232</td><td class="line">    <span class='keyword'>return</span> <span class='keyword'>new</span> IslamicCalendar(*<span class='keyword'>this</span>);</td></tr>
<tr><td class="num" id="LN233">233</td><td class="line">}</td></tr>
<tr><td class="num" id="LN234">234</td><td class="line"> </td></tr>
<tr><td class="num" id="LN235">235</td><td class="line">IslamicCalendar::IslamicCalendar(<span class='keyword'>const</span> Locale&amp; aLocale, UErrorCode&amp; success, ECalculationType type)</td></tr>
<tr><td class="num" id="LN236">236</td><td class="line">:   Calendar(TimeZone::createDefault(), aLocale, success),</td></tr>
<tr><td class="num" id="LN237">237</td><td class="line">cType(type)</td></tr>
<tr><td class="num" id="LN238">238</td><td class="line">{</td></tr>
<tr><td class="num" id="LN239">239</td><td class="line">    setTimeInMillis(getNow(), success); <span class='comment'>// Call this again now that the vtable is set up properly.</span></td></tr>
<tr><td class="num" id="LN240">240</td><td class="line">}</td></tr>
<tr><td class="num" id="LN241">241</td><td class="line"> </td></tr>
<tr><td class="num" id="LN242">242</td><td class="line">IslamicCalendar::IslamicCalendar(<span class='keyword'>const</span> IslamicCalendar&amp; other) : Calendar(other), cType(other.cType) {</td></tr>
<tr><td class="num" id="LN243">243</td><td class="line">}</td></tr>
<tr><td class="num" id="LN244">244</td><td class="line"> </td></tr>
<tr><td class="num" id="LN245">245</td><td class="line">IslamicCalendar::~IslamicCalendar()</td></tr>
<tr><td class="num" id="LN246">246</td><td class="line">{</td></tr>
<tr><td class="num" id="LN247">247</td><td class="line">}</td></tr>
<tr><td class="num" id="LN248">248</td><td class="line"> </td></tr>
<tr><td class="num" id="LN249">249</td><td class="line"><span class='keyword'>void</span> IslamicCalendar::setCalculationType(ECalculationType type, UErrorCode &amp;status)</td></tr>
<tr><td class="num" id="LN250">250</td><td class="line">{</td></tr>
<tr><td class="num" id="LN251">251</td><td class="line">    <span class='keyword'>if</span> (cType != type) {</td></tr>
<tr><td class="num" id="LN252">252</td><td class="line">        <span class='comment'>// The fields of the calendar will become invalid, because the calendar</span></td></tr>
<tr><td class="num" id="LN253">253</td><td class="line">        <span class='comment'>// rules are different</span></td></tr>
<tr><td class="num" id="LN254">254</td><td class="line">        UDate m = getTimeInMillis(status);</td></tr>
<tr><td class="num" id="LN255">255</td><td class="line">        cType = type;</td></tr>
<tr><td class="num" id="LN256">256</td><td class="line">        clear();</td></tr>
<tr><td class="num" id="LN257">257</td><td class="line">        setTimeInMillis(m, status);</td></tr>
<tr><td class="num" id="LN258">258</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN259">259</td><td class="line">}</td></tr>
<tr><td class="num" id="LN260">260</td><td class="line"> </td></tr>
<tr><td class="num" id="LN261">261</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN262">262</td><td class="line"><span class='comment'>* Returns &lt;code&gt;true&lt;/code&gt; if this object is using the fixed-cycle civil</span></td></tr>
<tr><td class="num" id="LN263">263</td><td class="line"><span class='comment'>* calendar, or &lt;code&gt;false&lt;/code&gt; if using the religious, astronomical</span></td></tr>
<tr><td class="num" id="LN264">264</td><td class="line"><span class='comment'>* calendar.</span></td></tr>
<tr><td class="num" id="LN265">265</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN266">266</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN267">267</td><td class="line">UBool IslamicCalendar::isCivil() {</td></tr>
<tr><td class="num" id="LN268">268</td><td class="line">    <span class='keyword'>return</span> (cType == CIVIL);</td></tr>
<tr><td class="num" id="LN269">269</td><td class="line">}</td></tr>
<tr><td class="num" id="LN270">270</td><td class="line"> </td></tr>
<tr><td class="num" id="LN271">271</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN272">272</td><td class="line"><span class='comment'>// Minimum / Maximum access functions</span></td></tr>
<tr><td class="num" id="LN273">273</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN274">274</td><td class="line"> </td></tr>
<tr><td class="num" id="LN275">275</td><td class="line"><span class='comment'>// Note: Current IslamicCalendar implementation does not work</span></td></tr>
<tr><td class="num" id="LN276">276</td><td class="line"><span class='comment'>// well with negative years.</span></td></tr>
<tr><td class="num" id="LN277">277</td><td class="line"> </td></tr>
<tr><td class="num" id="LN278">278</td><td class="line"><span class='comment'>// TODO: In some cases the current ICU Islamic calendar implementation shows</span></td></tr>
<tr><td class="num" id="LN279">279</td><td class="line"><span class='comment'>// a month as having 31 days. Since date parsing now uses range checks based</span></td></tr>
<tr><td class="num" id="LN280">280</td><td class="line"><span class='comment'>// on the table below, we need to change the range for last day of month to</span></td></tr>
<tr><td class="num" id="LN281">281</td><td class="line"><span class='comment'>// include 31 as a workaround until the implementation is fixed.</span></td></tr>
<tr><td class="num" id="LN282">282</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> int32_t LIMITS[UCAL_FIELD_COUNT][4] = {</td></tr>
<tr><td class="num" id="LN283">283</td><td class="line">    <span class='comment'>// Minimum  Greatest    Least  Maximum</span></td></tr>
<tr><td class="num" id="LN284">284</td><td class="line">    <span class='comment'>//           Minimum  Maximum</span></td></tr>
<tr><td class="num" id="LN285">285</td><td class="line">    {        0,        0,        0,        0}, <span class='comment'>// ERA</span></td></tr>
<tr><td class="num" id="LN286">286</td><td class="line">    {        1,        1,  5000000,  5000000}, <span class='comment'>// YEAR</span></td></tr>
<tr><td class="num" id="LN287">287</td><td class="line">    {        0,        0,       11,       11}, <span class='comment'>// MONTH</span></td></tr>
<tr><td class="num" id="LN288">288</td><td class="line">    {        1,        1,       50,       51}, <span class='comment'>// WEEK_OF_YEAR</span></td></tr>
<tr><td class="num" id="LN289">289</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// WEEK_OF_MONTH</span></td></tr>
<tr><td class="num" id="LN290">290</td><td class="line">    {        1,        1,       29,       31}, <span class='comment'>// DAY_OF_MONTH - 31 to workaround for cal implementation bug, should be 30</span></td></tr>
<tr><td class="num" id="LN291">291</td><td class="line">    {        1,        1,      354,      355}, <span class='comment'>// DAY_OF_YEAR</span></td></tr>
<tr><td class="num" id="LN292">292</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// DAY_OF_WEEK</span></td></tr>
<tr><td class="num" id="LN293">293</td><td class="line">    {       -1,       -1,        5,        5}, <span class='comment'>// DAY_OF_WEEK_IN_MONTH</span></td></tr>
<tr><td class="num" id="LN294">294</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// AM_PM</span></td></tr>
<tr><td class="num" id="LN295">295</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// HOUR</span></td></tr>
<tr><td class="num" id="LN296">296</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// HOUR_OF_DAY</span></td></tr>
<tr><td class="num" id="LN297">297</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// MINUTE</span></td></tr>
<tr><td class="num" id="LN298">298</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// SECOND</span></td></tr>
<tr><td class="num" id="LN299">299</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// MILLISECOND</span></td></tr>
<tr><td class="num" id="LN300">300</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// ZONE_OFFSET</span></td></tr>
<tr><td class="num" id="LN301">301</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// DST_OFFSET</span></td></tr>
<tr><td class="num" id="LN302">302</td><td class="line">    {        1,        1,  5000000,  5000000}, <span class='comment'>// YEAR_WOY</span></td></tr>
<tr><td class="num" id="LN303">303</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// DOW_LOCAL</span></td></tr>
<tr><td class="num" id="LN304">304</td><td class="line">    {        1,        1,  5000000,  5000000}, <span class='comment'>// EXTENDED_YEAR</span></td></tr>
<tr><td class="num" id="LN305">305</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// JULIAN_DAY</span></td></tr>
<tr><td class="num" id="LN306">306</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// MILLISECONDS_IN_DAY</span></td></tr>
<tr><td class="num" id="LN307">307</td><td class="line">    {<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1,<span class='comment'>/*N/A*/</span>-1}, <span class='comment'>// IS_LEAP_MONTH</span></td></tr>
<tr><td class="num" id="LN308">308</td><td class="line">};</td></tr>
<tr><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr><td class="num" id="LN310">310</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN311">311</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN312">312</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN313">313</td><td class="line">int32_t IslamicCalendar::handleGetLimit(UCalendarDateFields field, ELimitType limitType) <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN314">314</td><td class="line">    <span class='keyword'>return</span> LIMITS[field][limitType];</td></tr>
<tr><td class="num" id="LN315">315</td><td class="line">}</td></tr>
<tr><td class="num" id="LN316">316</td><td class="line"> </td></tr>
<tr><td class="num" id="LN317">317</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN318">318</td><td class="line"><span class='comment'>// Assorted calculation utilities</span></td></tr>
<tr><td class="num" id="LN319">319</td><td class="line"><span class='comment'>//</span></td></tr>
<tr><td class="num" id="LN320">320</td><td class="line"> </td></tr>
<tr><td class="num" id="LN321">321</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN322">322</td><td class="line"><span class='comment'>* Determine whether a year is a leap year in the Islamic civil calendar</span></td></tr>
<tr><td class="num" id="LN323">323</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN324">324</td><td class="line">UBool IslamicCalendar::civilLeapYear(int32_t year)</td></tr>
<tr><td class="num" id="LN325">325</td><td class="line">{</td></tr>
<tr><td class="num" id="LN326">326</td><td class="line">    <span class='keyword'>return</span> (14 + 11 * year) % 30 &lt; 11;</td></tr>
<tr><td class="num" id="LN327">327</td><td class="line">}</td></tr>
<tr><td class="num" id="LN328">328</td><td class="line"> </td></tr>
<tr><td class="num" id="LN329">329</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN330">330</td><td class="line"><span class='comment'>* Return the day # on which the given year starts.  Days are counted</span></td></tr>
<tr><td class="num" id="LN331">331</td><td class="line"><span class='comment'>* from the Hijri epoch, origin 0.</span></td></tr>
<tr><td class="num" id="LN332">332</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN333">333</td><td class="line">int32_t IslamicCalendar::yearStart(int32_t year) <span class='keyword'>const</span>{</td></tr>
<tr><td class="num" id="LN334">334</td><td class="line">    <span class='keyword'>if</span> (cType == CIVIL || cType == TBLA ||</td></tr>
<tr><td class="num" id="LN335">335</td><td class="line">        (cType == UMALQURA &amp;&amp; (year &lt; UMALQURA_YEAR_START || year &gt; UMALQURA_YEAR_END))) </td></tr>
<tr><td class="num" id="LN336">336</td><td class="line">    {</td></tr>
<tr><td class="num" id="LN337">337</td><td class="line">        <span class='keyword'>return</span> (year-1)*354 + ClockMath::floorDivide((3+11*year),30);</td></tr>
<tr><td class="num" id="LN338">338</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType==ASTRONOMICAL){</td></tr>
<tr><td class="num" id="LN339">339</td><td class="line">        <span class='keyword'>return</span> trueMonthStart(12*(year-1));</td></tr>
<tr><td class="num" id="LN340">340</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN341">341</td><td class="line">        int32_t ys = yearStart(UMALQURA_YEAR_START-1);</td></tr>
<tr><td class="num" id="LN342">342</td><td class="line">        ys+= handleGetYearLength(UMALQURA_YEAR_START-1);</td></tr>
<tr><td class="num" id="LN343">343</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i=UMALQURA_YEAR_START; i&lt; year; i++){  </td></tr>
<tr><td class="num" id="LN344">344</td><td class="line">            ys+= handleGetYearLength(i);</td></tr>
<tr><td class="num" id="LN345">345</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN346">346</td><td class="line">        <span class='keyword'>return</span> ys;</td></tr>
<tr><td class="num" id="LN347">347</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN348">348</td><td class="line">}</td></tr>
<tr><td class="num" id="LN349">349</td><td class="line"> </td></tr>
<tr><td class="num" id="LN350">350</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN351">351</td><td class="line"><span class='comment'>* Return the day # on which the given month starts.  Days are counted</span></td></tr>
<tr><td class="num" id="LN352">352</td><td class="line"><span class='comment'>* from the Hijri epoch, origin 0.</span></td></tr>
<tr><td class="num" id="LN353">353</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN354">354</td><td class="line"><span class='comment'>* @param year  The hijri year</span></td></tr>
<tr><td class="num" id="LN355">355</td><td class="line"><span class='comment'>* @param year  The hijri month, 0-based (assumed to be in range 0..11)</span></td></tr>
<tr><td class="num" id="LN356">356</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN357">357</td><td class="line">int32_t IslamicCalendar::monthStart(int32_t year, int32_t month) <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN358">358</td><td class="line">    <span class='keyword'>if</span> (cType == CIVIL || cType == TBLA) {</td></tr>
<tr><td class="num" id="LN359">359</td><td class="line">        <span class='comment'>// This does not handle months out of the range 0..11</span></td></tr>
<tr><td class="num" id="LN360">360</td><td class="line">        <span class='keyword'>return</span> (int32_t)<span class='macro'>uprv_ceil<span class='expansion'>uprv_ceil_54</span></span>(29.5*month)</td></tr>
<tr><td class="num" id="LN361">361</td><td class="line">            + (year-1)*354 + (int32_t)ClockMath::floorDivide((3+11*year),30);</td></tr>
<tr><td class="num" id="LN362">362</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType==ASTRONOMICAL){</td></tr>
<tr><td class="num" id="LN363">363</td><td class="line">        <span class='keyword'>return</span> trueMonthStart(12*(year-1) + month);</td></tr>
<tr><td class="num" id="LN364">364</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN365">365</td><td class="line">        int32_t ms = yearStart(year);</td></tr>
<tr><td class="num" id="LN366">366</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i=0; i&lt; month; i++){</td></tr>
<tr><td class="num" id="LN367">367</td><td class="line">            ms+= handleGetMonthLength(year, i);</td></tr>
<tr><td class="num" id="LN368">368</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN369">369</td><td class="line">        <span class='keyword'>return</span> ms;</td></tr>
<tr><td class="num" id="LN370">370</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN371">371</td><td class="line">}</td></tr>
<tr><td class="num" id="LN372">372</td><td class="line"> </td></tr>
<tr><td class="num" id="LN373">373</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN374">374</td><td class="line"><span class='comment'>* Find the day number on which a particular month of the true/lunar</span></td></tr>
<tr><td class="num" id="LN375">375</td><td class="line"><span class='comment'>* Islamic calendar starts.</span></td></tr>
<tr><td class="num" id="LN376">376</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN377">377</td><td class="line"><span class='comment'>* @param month The month in question, origin 0 from the Hijri epoch</span></td></tr>
<tr><td class="num" id="LN378">378</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN379">379</td><td class="line"><span class='comment'>* @return The day number on which the given month starts.</span></td></tr>
<tr><td class="num" id="LN380">380</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN381">381</td><td class="line">int32_t IslamicCalendar::trueMonthStart(int32_t month) <span class='keyword'>const</span></td></tr>
<tr><td class="num" id="LN382">382</td><td class="line">{</td></tr>
<tr><td class="num" id="LN383">383</td><td class="line">    UErrorCode status = U_ZERO_ERROR;</td></tr>
<tr><td class="num" id="LN384">384</td><td class="line">    int32_t start = CalendarCache::get(&amp;gMonthCache, month, status);</td></tr>
<tr><td class="num" id="LN385">385</td><td class="line"> </td></tr>
<tr><td class="num" id="LN386">386</td><td class="line">    <span class='keyword'>if</span> (start==0) {</td></tr>
<tr><td class="num" id="LN387">387</td><td class="line">        <span class='comment'>// Make a guess at when the month started, using the average length</span></td></tr>
<tr><td class="num" id="LN388">388</td><td class="line">        UDate origin = HIJRA_MILLIS </td></tr>
<tr><td class="num" id="LN389">389</td><td class="line">            + <span class='macro'>uprv_floor<span class='expansion'>uprv_floor_54</span></span>(month * CalendarAstronomer::SYNODIC_MONTH) * <span class='macro'>kOneDay<span class='expansion'>(1.0 * (86400000))</span></span>;</td></tr>
<tr><td class="num" id="LN390">390</td><td class="line"> </td></tr>
<tr><td class="num" id="LN391">391</td><td class="line">        <span class='comment'>// moonAge will fail due to memory allocation error</span></td></tr>
<tr><td class="num" id="LN392">392</td><td class="line">        <span class='keyword'>double</span> age = moonAge(origin, status);</td></tr>
<tr><td class="num" id="LN393">393</td><td class="line">        <span class='keyword'>if</span> (U_FAILURE(status)) {</td></tr>
<tr><td class="num" id="LN394">394</td><td class="line">            <span class='keyword'>goto</span> trueMonthStartEnd;</td></tr>
<tr><td class="num" id="LN395">395</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN396">396</td><td class="line"> </td></tr>
<tr><td class="num" id="LN397">397</td><td class="line">        <span class='keyword'>if</span> (age &gt;= 0) {</td></tr>
<tr><td class="num" id="LN398">398</td><td class="line">            <span class='comment'>// The month has already started</span></td></tr>
<tr><td class="num" id="LN399">399</td><td class="line">            <span class='keyword'>do</span> {</td></tr>
<tr><td class="num" id="LN400">400</td><td class="line">                origin -= <span class='macro'>kOneDay<span class='expansion'>(1.0 * (86400000))</span></span>;</td></tr>
<tr><td class="num" id="LN401">401</td><td class="line">                age = moonAge(origin, status);</td></tr>
<tr><td class="num" id="LN402">402</td><td class="line">                <span class='keyword'>if</span> (U_FAILURE(status)) {</td></tr>
<tr><td class="num" id="LN403">403</td><td class="line">                    <span class='keyword'>goto</span> trueMonthStartEnd;</td></tr>
<tr><td class="num" id="LN404">404</td><td class="line">                }</td></tr>
<tr><td class="num" id="LN405">405</td><td class="line">            } <span class='keyword'>while</span> (age &gt;= 0);</td></tr>
<tr><td class="num" id="LN406">406</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN407">407</td><td class="line">        <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN408">408</td><td class="line">            <span class='comment'>// Preceding month has not ended yet.</span></td></tr>
<tr><td class="num" id="LN409">409</td><td class="line">            <span class='keyword'>do</span> {</td></tr>
<tr><td class="num" id="LN410">410</td><td class="line">                origin += <span class='macro'>kOneDay<span class='expansion'>(1.0 * (86400000))</span></span>;</td></tr>
<tr><td class="num" id="LN411">411</td><td class="line">                age = moonAge(origin, status);</td></tr>
<tr><td class="num" id="LN412">412</td><td class="line">                <span class='keyword'>if</span> (U_FAILURE(status)) {</td></tr>
<tr><td class="num" id="LN413">413</td><td class="line">                    <span class='keyword'>goto</span> trueMonthStartEnd;</td></tr>
<tr><td class="num" id="LN414">414</td><td class="line">                }</td></tr>
<tr><td class="num" id="LN415">415</td><td class="line">            } <span class='keyword'>while</span> (age &lt; 0);</td></tr>
<tr><td class="num" id="LN416">416</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN417">417</td><td class="line">        start = (int32_t)ClockMath::floorDivide((origin - HIJRA_MILLIS), (<span class='keyword'>double</span>)<span class='macro'>kOneDay<span class='expansion'>(1.0 * (86400000))</span></span>) + 1;</td></tr>
<tr><td class="num" id="LN418">418</td><td class="line">        CalendarCache::put(&amp;gMonthCache, month, start, status);</td></tr>
<tr><td class="num" id="LN419">419</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN420">420</td><td class="line">trueMonthStartEnd :</td></tr>
<tr><td class="num" id="LN421">421</td><td class="line">    <span class='keyword'>if</span>(U_FAILURE(status)) {</td></tr>
<tr><td class="num" id="LN422">422</td><td class="line">        start = 0;</td></tr>
<tr><td class="num" id="LN423">423</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN424">424</td><td class="line">    <span class='keyword'>return</span> start;</td></tr>
<tr><td class="num" id="LN425">425</td><td class="line">}</td></tr>
<tr><td class="num" id="LN426">426</td><td class="line"> </td></tr>
<tr><td class="num" id="LN427">427</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN428">428</td><td class="line"><span class='comment'>* Return the "age" of the moon at the given time; this is the difference</span></td></tr>
<tr><td class="num" id="LN429">429</td><td class="line"><span class='comment'>* in ecliptic latitude between the moon and the sun.  This method simply</span></td></tr>
<tr><td class="num" id="LN430">430</td><td class="line"><span class='comment'>* calls CalendarAstronomer.moonAge, converts to degrees,</span> </td></tr>
<tr><td class="num" id="LN431">431</td><td class="line"><span class='comment'>* and adjusts the result to be in the range [-180, 180].</span></td></tr>
<tr><td class="num" id="LN432">432</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN433">433</td><td class="line"><span class='comment'>* @param time  The time at which the moon's age is desired,</span></td></tr>
<tr><td class="num" id="LN434">434</td><td class="line"><span class='comment'>*              in millis since 1/1/1970.</span></td></tr>
<tr><td class="num" id="LN435">435</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN436">436</td><td class="line"><span class='keyword'>double</span> IslamicCalendar::moonAge(UDate time, UErrorCode &amp;status)</td></tr>
<tr><td class="num" id="LN437">437</td><td class="line">{</td></tr>
<tr><td class="num" id="LN438">438</td><td class="line">    <span class='keyword'>double</span> age = 0;</td></tr>
<tr><td class="num" id="LN439">439</td><td class="line"> </td></tr>
<tr><td class="num" id="LN440">440</td><td class="line">    <span class='macro'>umtx_lock<span class='expansion'>umtx_lock_54</span></span>(&amp;astroLock);</td></tr>
<tr><td class="num" id="LN441">441</td><td class="line">    <span class='keyword'>if</span>(gIslamicCalendarAstro == <span class='macro'>NULL<span class='expansion'>__null</span></span>) {</td></tr>
<tr><td class="num" id="LN442">442</td><td class="line">        gIslamicCalendarAstro = <span class='keyword'>new</span> CalendarAstronomer();</td></tr>
<tr><td class="num" id="LN443">443</td><td class="line">        <span class='keyword'>if</span> (gIslamicCalendarAstro == <span class='macro'>NULL<span class='expansion'>__null</span></span>) {</td></tr>
<tr><td class="num" id="LN444">444</td><td class="line">            status = U_MEMORY_ALLOCATION_ERROR;</td></tr>
<tr><td class="num" id="LN445">445</td><td class="line">            <span class='keyword'>return</span> age;</td></tr>
<tr><td class="num" id="LN446">446</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN447">447</td><td class="line">        <span class='macro'>ucln_i18n_registerCleanup<span class='expansion'>ucln_i18n_registerCleanup_54</span></span>(UCLN_I18N_ISLAMIC_CALENDAR, calendar_islamic_cleanup);</td></tr>
<tr><td class="num" id="LN448">448</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN449">449</td><td class="line">    gIslamicCalendarAstro-&gt;setTime(time);</td></tr>
<tr><td class="num" id="LN450">450</td><td class="line">    age = gIslamicCalendarAstro-&gt;getMoonAge();</td></tr>
<tr><td class="num" id="LN451">451</td><td class="line">    <span class='macro'>umtx_unlock<span class='expansion'>umtx_unlock_54</span></span>(&amp;astroLock);</td></tr>
<tr><td class="num" id="LN452">452</td><td class="line"> </td></tr>
<tr><td class="num" id="LN453">453</td><td class="line">    <span class='comment'>// Convert to degrees and normalize...</span></td></tr>
<tr><td class="num" id="LN454">454</td><td class="line">    age = age * 180 / CalendarAstronomer::PI;</td></tr>
<tr><td class="num" id="LN455">455</td><td class="line">    <span class='keyword'>if</span> (age &gt; 180) {</td></tr>
<tr><td class="num" id="LN456">456</td><td class="line">        age = age - 360;</td></tr>
<tr><td class="num" id="LN457">457</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN458">458</td><td class="line"> </td></tr>
<tr><td class="num" id="LN459">459</td><td class="line">    <span class='keyword'>return</span> age;</td></tr>
<tr><td class="num" id="LN460">460</td><td class="line">}</td></tr>
<tr><td class="num" id="LN461">461</td><td class="line"> </td></tr>
<tr><td class="num" id="LN462">462</td><td class="line"><span class='comment'>//----------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN463">463</td><td class="line"><span class='comment'>// Calendar framework</span></td></tr>
<tr><td class="num" id="LN464">464</td><td class="line"><span class='comment'>//----------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN465">465</td><td class="line"> </td></tr>
<tr><td class="num" id="LN466">466</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN467">467</td><td class="line"><span class='comment'>* Return the length (in days) of the given month.</span></td></tr>
<tr><td class="num" id="LN468">468</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN469">469</td><td class="line"><span class='comment'>* @param year  The hijri year</span></td></tr>
<tr><td class="num" id="LN470">470</td><td class="line"><span class='comment'>* @param year  The hijri month, 0-based</span></td></tr>
<tr><td class="num" id="LN471">471</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN472">472</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN473">473</td><td class="line">int32_t IslamicCalendar::handleGetMonthLength(int32_t extendedYear, int32_t month) <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN474">474</td><td class="line"> </td></tr>
<tr><td class="num" id="LN475">475</td><td class="line">    int32_t length = 0;</td></tr>
<tr><td class="num" id="LN476">476</td><td class="line"> </td></tr>
<tr><td class="num" id="LN477">477</td><td class="line">    <span class='keyword'>if</span> (cType == CIVIL || cType == TBLA ||</td></tr>
<tr><td class="num" id="LN478">478</td><td class="line">        (cType == UMALQURA &amp;&amp; (extendedYear&lt;UMALQURA_YEAR_START || extendedYear&gt;UMALQURA_YEAR_END)) ) {</td></tr>
<tr><td class="num" id="LN479">479</td><td class="line">        length = 29 + (month+1) % 2;</td></tr>
<tr><td class="num" id="LN480">480</td><td class="line">        <span class='keyword'>if</span> (month == DHU_AL_HIJJAH &amp;&amp; civilLeapYear(extendedYear)) {</td></tr>
<tr><td class="num" id="LN481">481</td><td class="line">            length++;</td></tr>
<tr><td class="num" id="LN482">482</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN483">483</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType == ASTRONOMICAL){</td></tr>
<tr><td class="num" id="LN484">484</td><td class="line">        month = 12*(extendedYear-1) + month;</td></tr>
<tr><td class="num" id="LN485">485</td><td class="line">        length =  trueMonthStart(month+1) - trueMonthStart(month) ;</td></tr>
<tr><td class="num" id="LN486">486</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN487">487</td><td class="line">        length = getUmalqura_MonthLength(extendedYear - UMALQURA_YEAR_START, month);</td></tr>
<tr><td class="num" id="LN488">488</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN489">489</td><td class="line">    <span class='keyword'>return</span> length;</td></tr>
<tr><td class="num" id="LN490">490</td><td class="line">}</td></tr>
<tr><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr><td class="num" id="LN492">492</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN493">493</td><td class="line"><span class='comment'>* Return the number of days in the given Islamic year</span></td></tr>
<tr><td class="num" id="LN494">494</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN495">495</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN496">496</td><td class="line">int32_t IslamicCalendar::handleGetYearLength(int32_t extendedYear) <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN497">497</td><td class="line">    <span class='keyword'>if</span> (cType == CIVIL || cType == TBLA ||</td></tr>
<tr><td class="num" id="LN498">498</td><td class="line">        (cType == UMALQURA &amp;&amp; (extendedYear&lt;UMALQURA_YEAR_START || extendedYear&gt;UMALQURA_YEAR_END)) ) {</td></tr>
<tr><td class="num" id="LN499">499</td><td class="line">        <span class='keyword'>return</span> 354 + (civilLeapYear(extendedYear) ? 1 : 0);</td></tr>
<tr><td class="num" id="LN500">500</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType == ASTRONOMICAL){</td></tr>
<tr><td class="num" id="LN501">501</td><td class="line">        int32_t month = 12*(extendedYear-1);</td></tr>
<tr><td class="num" id="LN502">502</td><td class="line">        <span class='keyword'>return</span> (trueMonthStart(month + 12) - trueMonthStart(month));</td></tr>
<tr><td class="num" id="LN503">503</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN504">504</td><td class="line">        <span class='keyword'>int</span> len = 0;</td></tr>
<tr><td class="num" id="LN505">505</td><td class="line">        <span class='keyword'>for</span>(<span class='keyword'>int</span> i=0; i&lt;12; i++) {</td></tr>
<tr><td class="num" id="LN506">506</td><td class="line">            len += handleGetMonthLength(extendedYear, i);</td></tr>
<tr><td class="num" id="LN507">507</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN508">508</td><td class="line">        <span class='keyword'>return</span> len;</td></tr>
<tr><td class="num" id="LN509">509</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN510">510</td><td class="line">}</td></tr>
<tr><td class="num" id="LN511">511</td><td class="line"> </td></tr>
<tr><td class="num" id="LN512">512</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN513">513</td><td class="line"><span class='comment'>// Functions for converting from field values to milliseconds....</span></td></tr>
<tr><td class="num" id="LN514">514</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN515">515</td><td class="line"> </td></tr>
<tr><td class="num" id="LN516">516</td><td class="line"><span class='comment'>// Return JD of start of given month/year</span></td></tr>
<tr><td class="num" id="LN517">517</td><td class="line"><span class='comment'>// Calendar says:</span></td></tr>
<tr><td class="num" id="LN518">518</td><td class="line"><span class='comment'>// Get the Julian day of the day BEFORE the start of this year.</span></td></tr>
<tr><td class="num" id="LN519">519</td><td class="line"><span class='comment'>// If useMonth is true, get the day before the start of the month.</span></td></tr>
<tr><td class="num" id="LN520">520</td><td class="line"><span class='comment'>// Hence the -1</span></td></tr>
<tr><td class="num" id="LN521">521</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN522">522</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN523">523</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN524">524</td><td class="line">int32_t IslamicCalendar::handleComputeMonthStart(int32_t eyear, int32_t month, UBool <span class='comment'>/* useMonth */</span>) <span class='keyword'>const</span> {</td></tr>
<tr><td class="num" id="LN525">525</td><td class="line">    <span class='comment'>// This may be called by Calendar::handleComputeJulianDay with months out of the range</span></td></tr>
<tr><td class="num" id="LN526">526</td><td class="line">    <span class='comment'>// 0..11. Need to handle that here since monthStart requires months in the range 0.11.</span></td></tr>
<tr><td class="num" id="LN527">527</td><td class="line">    <span class='keyword'>if</span> (month &gt; 11) {</td></tr>
<tr><td class="num" id="LN528">528</td><td class="line">        eyear += (month / 12);</td></tr>
<tr><td class="num" id="LN529">529</td><td class="line">        month %= 12;</td></tr>
<tr><td class="num" id="LN530">530</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span> (month &lt; 0) {</td></tr>
<tr><td class="num" id="LN531">531</td><td class="line">        month++;</td></tr>
<tr><td class="num" id="LN532">532</td><td class="line">        eyear += (month / 12) - 1;</td></tr>
<tr><td class="num" id="LN533">533</td><td class="line">        month = (month % 12) + 11;</td></tr>
<tr><td class="num" id="LN534">534</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN535">535</td><td class="line">    <span class='keyword'>return</span> monthStart(eyear, month) + ((cType == TBLA)? ASTRONOMICAL_EPOC: CIVIL_EPOC) - 1;</td></tr>
<tr><td class="num" id="LN536">536</td><td class="line">}    </td></tr>
<tr><td class="num" id="LN537">537</td><td class="line"> </td></tr>
<tr><td class="num" id="LN538">538</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN539">539</td><td class="line"><span class='comment'>// Functions for converting from milliseconds to field values</span></td></tr>
<tr><td class="num" id="LN540">540</td><td class="line"><span class='comment'>//-------------------------------------------------------------------------</span></td></tr>
<tr><td class="num" id="LN541">541</td><td class="line"> </td></tr>
<tr><td class="num" id="LN542">542</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN543">543</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN544">544</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN545">545</td><td class="line">int32_t IslamicCalendar::handleGetExtendedYear() {</td></tr>
<tr><td class="num" id="LN546">546</td><td class="line">    int32_t year;</td></tr>
<tr><td class="num" id="LN547">547</td><td class="line">    <span class='keyword'>if</span> (newerField(UCAL_EXTENDED_YEAR, UCAL_YEAR) == UCAL_EXTENDED_YEAR) {</td></tr>
<tr><td class="num" id="LN548">548</td><td class="line">        year = internalGet(UCAL_EXTENDED_YEAR, 1); <span class='comment'>// Default to year 1</span></td></tr>
<tr><td class="num" id="LN549">549</td><td class="line">    } <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN550">550</td><td class="line">        year = internalGet(UCAL_YEAR, 1); <span class='comment'>// Default to year 1</span></td></tr>
<tr><td class="num" id="LN551">551</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN552">552</td><td class="line">    <span class='keyword'>return</span> year;</td></tr>
<tr><td class="num" id="LN553">553</td><td class="line">}</td></tr>
<tr><td class="num" id="LN554">554</td><td class="line"> </td></tr>
<tr><td class="num" id="LN555">555</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN556">556</td><td class="line"><span class='comment'>* Override Calendar to compute several fields specific to the Islamic</span></td></tr>
<tr><td class="num" id="LN557">557</td><td class="line"><span class='comment'>* calendar system.  These are:</span></td></tr>
<tr><td class="num" id="LN558">558</td><td class="line"><span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN559">559</td><td class="line"><span class='comment'>* &lt;ul&gt;&lt;li&gt;ERA</span></td></tr>
<tr><td class="num" id="LN560">560</td><td class="line"><span class='comment'>* &lt;li&gt;YEAR</span></td></tr>
<tr><td class="num" id="LN561">561</td><td class="line"><span class='comment'>* &lt;li&gt;MONTH</span></td></tr>
<tr><td class="num" id="LN562">562</td><td class="line"><span class='comment'>* &lt;li&gt;DAY_OF_MONTH</span></td></tr>
<tr><td class="num" id="LN563">563</td><td class="line"><span class='comment'>* &lt;li&gt;DAY_OF_YEAR</span></td></tr>
<tr><td class="num" id="LN564">564</td><td class="line"><span class='comment'>* &lt;li&gt;EXTENDED_YEAR&lt;/ul&gt;</span></td></tr>
<tr><td class="num" id="LN565">565</td><td class="line"><span class='comment'>*</span> </td></tr>
<tr><td class="num" id="LN566">566</td><td class="line"><span class='comment'>* The DAY_OF_WEEK and DOW_LOCAL fields are already set when this</span></td></tr>
<tr><td class="num" id="LN567">567</td><td class="line"><span class='comment'>* method is called. The getGregorianXxx() methods return Gregorian</span></td></tr>
<tr><td class="num" id="LN568">568</td><td class="line"><span class='comment'>* calendar equivalents for the given Julian day.</span></td></tr>
<tr><td class="num" id="LN569">569</td><td class="line"><span class='comment'>* @draft ICU 2.4</span></td></tr>
<tr><td class="num" id="LN570">570</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN571">571</td><td class="line"><span class='keyword'>void</span> IslamicCalendar::handleComputeFields(int32_t julianDay, UErrorCode &amp;status) {</td></tr>
<tr><td class="num" id="LN572">572</td><td class="line">    int32_t year, month, dayOfMonth, dayOfYear;</td></tr>
<tr><td class="num" id="LN573">573</td><td class="line">    int32_t startDate;</td></tr>
<tr><td class="num" id="LN574">574</td><td class="line">    int32_t days = julianDay - CIVIL_EPOC;</td></tr>
<tr><td class="num" id="LN575">575</td><td class="line"> </td></tr>
<tr><td class="num" id="LN576">576</td><td class="line">    <span class='keyword'>if</span> (cType == CIVIL || cType == TBLA) {</td></tr>
<tr><td class="num" id="LN577">577</td><td class="line">        <span class='keyword'>if</span>(cType == TBLA) {</td></tr>
<tr><td class="num" id="LN578">578</td><td class="line">            days = julianDay - ASTRONOMICAL_EPOC;</td></tr>
<tr><td class="num" id="LN579">579</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN580">580</td><td class="line">        <span class='comment'>// Use the civil calendar approximation, which is just arithmetic</span></td></tr>
<tr><td class="num" id="LN581">581</td><td class="line">        year  = (<span class='keyword'>int</span>)ClockMath::floorDivide( (<span class='keyword'>double</span>)(30 * days + 10646) , 10631.0 );</td></tr>
<tr><td class="num" id="LN582">582</td><td class="line">        month = (int32_t)<span class='macro'>uprv_ceil<span class='expansion'>uprv_ceil_54</span></span>((days - 29 - yearStart(year)) / 29.5 );</td></tr>
<tr><td class="num" id="LN583">583</td><td class="line">        month = month&lt;11?month:11;</td></tr>
<tr><td class="num" id="LN584">584</td><td class="line">        startDate = <span class="mrange">monthStart(year, month)</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:9ex">Value stored to 'startDate' is never read</div></td></tr>
<tr><td class="num" id="LN585">585</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType == ASTRONOMICAL){</td></tr>
<tr><td class="num" id="LN586">586</td><td class="line">        <span class='comment'>// Guess at the number of elapsed full months since the epoch</span></td></tr>
<tr><td class="num" id="LN587">587</td><td class="line">        int32_t months = (int32_t)<span class='macro'>uprv_floor<span class='expansion'>uprv_floor_54</span></span>((<span class='keyword'>double</span>)days / CalendarAstronomer::SYNODIC_MONTH);</td></tr>
<tr><td class="num" id="LN588">588</td><td class="line"> </td></tr>
<tr><td class="num" id="LN589">589</td><td class="line">        startDate = (int32_t)<span class='macro'>uprv_floor<span class='expansion'>uprv_floor_54</span></span>(months * CalendarAstronomer::SYNODIC_MONTH);</td></tr>
<tr><td class="num" id="LN590">590</td><td class="line"> </td></tr>
<tr><td class="num" id="LN591">591</td><td class="line">        <span class='keyword'>double</span> age = moonAge(internalGetTime(), status);</td></tr>
<tr><td class="num" id="LN592">592</td><td class="line">        <span class='keyword'>if</span> (U_FAILURE(status)) {</td></tr>
<tr><td class="num" id="LN593">593</td><td class="line">            status = U_MEMORY_ALLOCATION_ERROR;</td></tr>
<tr><td class="num" id="LN594">594</td><td class="line">            <span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN595">595</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN596">596</td><td class="line">        <span class='keyword'>if</span> ( days - startDate &gt;= 25 &amp;&amp; age &gt; 0) {</td></tr>
<tr><td class="num" id="LN597">597</td><td class="line">            <span class='comment'>// If we're near the end of the month, assume next month and search backwards</span></td></tr>
<tr><td class="num" id="LN598">598</td><td class="line">            months++;</td></tr>
<tr><td class="num" id="LN599">599</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN600">600</td><td class="line"> </td></tr>
<tr><td class="num" id="LN601">601</td><td class="line">        <span class='comment'>// Find out the last time that the new moon was actually visible at this longitude</span></td></tr>
<tr><td class="num" id="LN602">602</td><td class="line">        <span class='comment'>// This returns midnight the night that the moon was visible at sunset.</span></td></tr>
<tr><td class="num" id="LN603">603</td><td class="line">        <span class='keyword'>while</span> ((startDate = trueMonthStart(months)) &gt; days) {</td></tr>
<tr><td class="num" id="LN604">604</td><td class="line">            <span class='comment'>// If it was after the date in question, back up a month and try again</span></td></tr>
<tr><td class="num" id="LN605">605</td><td class="line">            months--;</td></tr>
<tr><td class="num" id="LN606">606</td><td class="line">        }</td></tr>
<tr><td class="num" id="LN607">607</td><td class="line"> </td></tr>
<tr><td class="num" id="LN608">608</td><td class="line">        year = months / 12 + 1;</td></tr>
<tr><td class="num" id="LN609">609</td><td class="line">        month = months % 12;</td></tr>
<tr><td class="num" id="LN610">610</td><td class="line">    } <span class='keyword'>else</span> <span class='keyword'>if</span>(cType == UMALQURA) {</td></tr>
<tr><td class="num" id="LN611">611</td><td class="line">        int32_t umalquraStartdays = yearStart(UMALQURA_YEAR_START) ;</td></tr>
<tr><td class="num" id="LN612">612</td><td class="line">        <span class='keyword'>if</span>( days &lt; umalquraStartdays){</td></tr>
<tr><td class="num" id="LN613">613</td><td class="line">                <span class='comment'>//Use Civil calculation</span></td></tr>
<tr><td class="num" id="LN614">614</td><td class="line">                year  = (<span class='keyword'>int</span>)ClockMath::floorDivide( (<span class='keyword'>double</span>)(30 * days + 10646) , 10631.0 );</td></tr>
<tr><td class="num" id="LN615">615</td><td class="line">                month = (int32_t)<span class='macro'>uprv_ceil<span class='expansion'>uprv_ceil_54</span></span>((days - 29 - yearStart(year)) / 29.5 );</td></tr>
<tr><td class="num" id="LN616">616</td><td class="line">                month = month&lt;11?month:11;</td></tr>
<tr><td class="num" id="LN617">617</td><td class="line">                startDate = monthStart(year, month);</td></tr>
<tr><td class="num" id="LN618">618</td><td class="line">            }<span class='keyword'>else</span>{</td></tr>
<tr><td class="num" id="LN619">619</td><td class="line">                <span class='keyword'>int</span> y =UMALQURA_YEAR_START-1, m =0;</td></tr>
<tr><td class="num" id="LN620">620</td><td class="line">                <span class='keyword'>long</span> d = 1;</td></tr>
<tr><td class="num" id="LN621">621</td><td class="line">                <span class='keyword'>while</span>(d &gt; 0){ </td></tr>
<tr><td class="num" id="LN622">622</td><td class="line">                    y++; </td></tr>
<tr><td class="num" id="LN623">623</td><td class="line">                    d = days - yearStart(y) +1;</td></tr>
<tr><td class="num" id="LN624">624</td><td class="line">                    <span class='keyword'>if</span>(d == handleGetYearLength(y)){</td></tr>
<tr><td class="num" id="LN625">625</td><td class="line">                        m=11;</td></tr>
<tr><td class="num" id="LN626">626</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN627">627</td><td class="line">                    }<span class='keyword'>else</span> <span class='keyword'>if</span>(d &lt; handleGetYearLength(y) ){</td></tr>
<tr><td class="num" id="LN628">628</td><td class="line">                        <span class='keyword'>int</span> monthLen = handleGetMonthLength(y, m); </td></tr>
<tr><td class="num" id="LN629">629</td><td class="line">                        m=0;</td></tr>
<tr><td class="num" id="LN630">630</td><td class="line">                        <span class='keyword'>while</span>(d &gt; monthLen){</td></tr>
<tr><td class="num" id="LN631">631</td><td class="line">                            d -= monthLen;</td></tr>
<tr><td class="num" id="LN632">632</td><td class="line">                            m++;</td></tr>
<tr><td class="num" id="LN633">633</td><td class="line">                            monthLen = handleGetMonthLength(y, m);</td></tr>
<tr><td class="num" id="LN634">634</td><td class="line">                        }</td></tr>
<tr><td class="num" id="LN635">635</td><td class="line">                        <span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN636">636</td><td class="line">                    }</td></tr>
<tr><td class="num" id="LN637">637</td><td class="line">                }</td></tr>
<tr><td class="num" id="LN638">638</td><td class="line">                year = y;</td></tr>
<tr><td class="num" id="LN639">639</td><td class="line">                month = m;</td></tr>
<tr><td class="num" id="LN640">640</td><td class="line">            }</td></tr>
<tr><td class="num" id="LN641">641</td><td class="line">    } <span class='keyword'>else</span> { <span class='comment'>// invalid 'civil'</span></td></tr>
<tr><td class="num" id="LN642">642</td><td class="line">      U_ASSERT(<span class='keyword'>false</span>); <span class='comment'>// should not get here, out of range</span></td></tr>
<tr><td class="num" id="LN643">643</td><td class="line">      year=month=0;</td></tr>
<tr><td class="num" id="LN644">644</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN645">645</td><td class="line"> </td></tr>
<tr><td class="num" id="LN646">646</td><td class="line">    dayOfMonth = (days - monthStart(year, month)) + 1;</td></tr>
<tr><td class="num" id="LN647">647</td><td class="line"> </td></tr>
<tr><td class="num" id="LN648">648</td><td class="line">    <span class='comment'>// Now figure out the day of the year.</span></td></tr>
<tr><td class="num" id="LN649">649</td><td class="line">    dayOfYear = (days - monthStart(year, 0)) + 1;</td></tr>
<tr><td class="num" id="LN650">650</td><td class="line"> </td></tr>
<tr><td class="num" id="LN651">651</td><td class="line"> </td></tr>
<tr><td class="num" id="LN652">652</td><td class="line">    internalSet(UCAL_ERA, 0);</td></tr>
<tr><td class="num" id="LN653">653</td><td class="line">    internalSet(UCAL_YEAR, year);</td></tr>
<tr><td class="num" id="LN654">654</td><td class="line">    internalSet(UCAL_EXTENDED_YEAR, year);</td></tr>
<tr><td class="num" id="LN655">655</td><td class="line">    internalSet(UCAL_MONTH, month);</td></tr>
<tr><td class="num" id="LN656">656</td><td class="line">    internalSet(UCAL_DAY_OF_MONTH, dayOfMonth);</td></tr>
<tr><td class="num" id="LN657">657</td><td class="line">    internalSet(UCAL_DAY_OF_YEAR, dayOfYear);       </td></tr>
<tr><td class="num" id="LN658">658</td><td class="line">}    </td></tr>
<tr><td class="num" id="LN659">659</td><td class="line"> </td></tr>
<tr><td class="num" id="LN660">660</td><td class="line">UBool</td></tr>
<tr><td class="num" id="LN661">661</td><td class="line">IslamicCalendar::inDaylightTime(UErrorCode&amp; status) <span class='keyword'>const</span></td></tr>
<tr><td class="num" id="LN662">662</td><td class="line">{</td></tr>
<tr><td class="num" id="LN663">663</td><td class="line">    <span class='comment'>// copied from GregorianCalendar</span></td></tr>
<tr><td class="num" id="LN664">664</td><td class="line">    <span class='keyword'>if</span> (U_FAILURE(status) || !getTimeZone().useDaylightTime()) </td></tr>
<tr><td class="num" id="LN665">665</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>FALSE<span class='expansion'>0</span></span>;</td></tr>
<tr><td class="num" id="LN666">666</td><td class="line"> </td></tr>
<tr><td class="num" id="LN667">667</td><td class="line">    <span class='comment'>// Force an update of the state of the Calendar.</span></td></tr>
<tr><td class="num" id="LN668">668</td><td class="line">    ((IslamicCalendar*)<span class='keyword'>this</span>)-&gt;complete(status); <span class='comment'>// cast away const</span></td></tr>
<tr><td class="num" id="LN669">669</td><td class="line"> </td></tr>
<tr><td class="num" id="LN670">670</td><td class="line">    <span class='keyword'>return</span> (UBool)(U_SUCCESS(status) ? (internalGet(UCAL_DST_OFFSET) != 0) : <span class='macro'>FALSE<span class='expansion'>0</span></span>);</td></tr>
<tr><td class="num" id="LN671">671</td><td class="line">}</td></tr>
<tr><td class="num" id="LN672">672</td><td class="line"> </td></tr>
<tr><td class="num" id="LN673">673</td><td class="line"><span class='comment'>/**</span></td></tr>
<tr><td class="num" id="LN674">674</td><td class="line"> <span class='comment'>* The system maintains a static default century start date and Year.  They are</span></td></tr>
<tr><td class="num" id="LN675">675</td><td class="line"> <span class='comment'>* initialized the first time they are used.  Once the system default century date</span> </td></tr>
<tr><td class="num" id="LN676">676</td><td class="line"> <span class='comment'>* and year are set, they do not change.</span></td></tr>
<tr><td class="num" id="LN677">677</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN678">678</td><td class="line"><span class='keyword'>static</span> UDate           gSystemDefaultCenturyStart       = <span class='macro'>DBL_MIN<span class='expansion'>2.2250738585072014e-308</span></span>;</td></tr>
<tr><td class="num" id="LN679">679</td><td class="line"><span class='keyword'>static</span> int32_t         gSystemDefaultCenturyStartYear   = -1;</td></tr>
<tr><td class="num" id="LN680">680</td><td class="line"><span class='keyword'>static</span> icu::UInitOnce  gSystemDefaultCenturyInit        = <span class='macro'>U_INITONCE_INITIALIZER<span class='expansion'>{0, U_ZERO_ERROR}</span></span>;</td></tr>
<tr><td class="num" id="LN681">681</td><td class="line"> </td></tr>
<tr><td class="num" id="LN682">682</td><td class="line"> </td></tr>
<tr><td class="num" id="LN683">683</td><td class="line">UBool IslamicCalendar::haveDefaultCentury() <span class='keyword'>const</span></td></tr>
<tr><td class="num" id="LN684">684</td><td class="line">{</td></tr>
<tr><td class="num" id="LN685">685</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>TRUE<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN686">686</td><td class="line">}</td></tr>
<tr><td class="num" id="LN687">687</td><td class="line"> </td></tr>
<tr><td class="num" id="LN688">688</td><td class="line">UDate IslamicCalendar::defaultCenturyStart() <span class='keyword'>const</span></td></tr>
<tr><td class="num" id="LN689">689</td><td class="line">{</td></tr>
<tr><td class="num" id="LN690">690</td><td class="line">    <span class='comment'>// lazy-evaluate systemDefaultCenturyStart</span></td></tr>
<tr><td class="num" id="LN691">691</td><td class="line">    umtx_initOnce(gSystemDefaultCenturyInit, &amp;initializeSystemDefaultCentury);</td></tr>
<tr><td class="num" id="LN692">692</td><td class="line">    <span class='keyword'>return</span> gSystemDefaultCenturyStart;</td></tr>
<tr><td class="num" id="LN693">693</td><td class="line">}</td></tr>
<tr><td class="num" id="LN694">694</td><td class="line"> </td></tr>
<tr><td class="num" id="LN695">695</td><td class="line">int32_t IslamicCalendar::defaultCenturyStartYear() <span class='keyword'>const</span></td></tr>
<tr><td class="num" id="LN696">696</td><td class="line">{</td></tr>
<tr><td class="num" id="LN697">697</td><td class="line">    <span class='comment'>// lazy-evaluate systemDefaultCenturyStartYear</span></td></tr>
<tr><td class="num" id="LN698">698</td><td class="line">    umtx_initOnce(gSystemDefaultCenturyInit, &amp;initializeSystemDefaultCentury);</td></tr>
<tr><td class="num" id="LN699">699</td><td class="line">    <span class='keyword'>return</span> gSystemDefaultCenturyStartYear;</td></tr>
<tr><td class="num" id="LN700">700</td><td class="line">}</td></tr>
<tr><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr><td class="num" id="LN702">702</td><td class="line"> </td></tr>
<tr><td class="num" id="LN703">703</td><td class="line"><span class='keyword'>void</span> U_CALLCONV</td></tr>
<tr><td class="num" id="LN704">704</td><td class="line">IslamicCalendar::initializeSystemDefaultCentury()</td></tr>
<tr><td class="num" id="LN705">705</td><td class="line">{</td></tr>
<tr><td class="num" id="LN706">706</td><td class="line">    <span class='comment'>// initialize systemDefaultCentury and systemDefaultCenturyYear based</span></td></tr>
<tr><td class="num" id="LN707">707</td><td class="line">    <span class='comment'>// on the current time.  They'll be set to 80 years before</span></td></tr>
<tr><td class="num" id="LN708">708</td><td class="line">    <span class='comment'>// the current time.</span></td></tr>
<tr><td class="num" id="LN709">709</td><td class="line">    UErrorCode status = U_ZERO_ERROR;</td></tr>
<tr><td class="num" id="LN710">710</td><td class="line">    IslamicCalendar calendar(Locale(<span class='string_literal'>"@calendar=islamic-civil"</span>),status);</td></tr>
<tr><td class="num" id="LN711">711</td><td class="line">    <span class='keyword'>if</span> (U_SUCCESS(status)) {</td></tr>
<tr><td class="num" id="LN712">712</td><td class="line">        calendar.setTime(Calendar::getNow(), status);</td></tr>
<tr><td class="num" id="LN713">713</td><td class="line">        calendar.add(UCAL_YEAR, -80, status);</td></tr>
<tr><td class="num" id="LN714">714</td><td class="line"> </td></tr>
<tr><td class="num" id="LN715">715</td><td class="line">        gSystemDefaultCenturyStart = calendar.getTime(status);</td></tr>
<tr><td class="num" id="LN716">716</td><td class="line">        gSystemDefaultCenturyStartYear = calendar.get(UCAL_YEAR, status);</td></tr>
<tr><td class="num" id="LN717">717</td><td class="line">    }</td></tr>
<tr><td class="num" id="LN718">718</td><td class="line">    <span class='comment'>// We have no recourse upon failure unless we want to propagate the failure</span></td></tr>
<tr><td class="num" id="LN719">719</td><td class="line">    <span class='comment'>// out.</span></td></tr>
<tr><td class="num" id="LN720">720</td><td class="line">}</td></tr>
<tr><td class="num" id="LN721">721</td><td class="line"> </td></tr>
<tr><td class="num" id="LN722">722</td><td class="line"> </td></tr>
<tr><td class="num" id="LN723">723</td><td class="line"> </td></tr>
<tr><td class="num" id="LN724">724</td><td class="line"><span class='macro'>UOBJECT_DEFINE_RTTI_IMPLEMENTATION(IslamicCalendar)<span class='expansion'>UClassID IslamicCalendar::getStaticClassID() { static char classID<br> = 0; return (UClassID)&amp;classID; } UClassID IslamicCalendar<br>::getDynamicClassID() const { return IslamicCalendar::getStaticClassID<br>(); }</span></span></td></tr>
<tr><td class="num" id="LN725">725</td><td class="line"> </td></tr>
<tr><td class="num" id="LN726">726</td><td class="line"><span class='macro'>U_NAMESPACE_END<span class='expansion'>} }</span></span></td></tr>
<tr><td class="num" id="LN727">727</td><td class="line"> </td></tr>
<tr><td class="num" id="LN728">728</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr><td class="num" id="LN729">729</td><td class="line"> </td></tr>
</table></body></html>
